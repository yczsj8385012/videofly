# AI Provider æ¥å…¥è§„èŒƒ

> **AI è¾…åŠ©å¼€å‘å‚è€ƒæ–‡æ¡£** | æœ€åæ›´æ–°: 2026-01-26

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£å®šä¹‰äº† VideoFly å¹³å°æ¥å…¥ AI è§†é¢‘ç”Ÿæˆæä¾›å•†çš„**æ¶æ„è§„èŒƒã€æ•°æ®ç»“æ„å’Œæ–¹æ³•çº¦å®š**ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š
1. å‘ AI æä¾›æœ¬æ–‡æ¡£ + ä¾›åº”å•† API æ–‡æ¡£
2. AI æ ¹æ®è§„èŒƒç”Ÿæˆç¬¦åˆæ¶æ„çš„ä»£ç 

**æ–‡æ¡£åŸåˆ™**ï¼š
- âœ… å…³æ³¨æ¶æ„ã€ç»“æ„å’Œè§„èŒƒ
- âœ… å…·ä½“ä»£ç å®ç°ç”± AI æ ¹æ®å½“å‰ä»£ç åº“ç”Ÿæˆ
- âœ… é¿å…ä»£ç å˜åŒ–å¯¼è‡´æ–‡æ¡£è¿‡æ—¶

---

## ğŸ—ï¸ ä¸‰å±‚æ˜ å°„æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬1å±‚ï¼šç”¨æˆ·å±‚ï¼ˆå‰ç«¯ UIï¼‰                                      â”‚
â”‚  ç”¨æˆ·çœ‹åˆ°çš„ç»Ÿä¸€æ¨¡å‹ ID: "sora-2", "wan2.6", "veo-3.1"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬2å±‚ï¼šæ˜ å°„å±‚ï¼ˆmodel-mapping.tsï¼‰                            â”‚
â”‚  â€¢ å†…éƒ¨æ¨¡å‹ ID â†’ ä¾›åº”å•†æ¨¡å‹ ID                                â”‚
â”‚  â€¢ ç»Ÿä¸€å‚æ•° â†’ ä¾›åº”å•†å‚æ•°                                      â”‚
â”‚  â€¢ åŠ¨æ€æ¨¡å‹é€‰æ‹©ï¼ˆåŸºäºå‚æ•°ï¼‰                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬3å±‚ï¼šProvider å±‚ï¼ˆproviders/*.tsï¼‰                         â”‚
â”‚  â€¢ AIVideoProvider æ¥å£å®ç°                                   â”‚
â”‚  â€¢ API è°ƒç”¨ã€çŠ¶æ€æŸ¥è¯¢ã€å›è°ƒè§£æ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾›åº”å•† APIï¼ˆEvolink / KIE / æ–°ä¾›åº”å•†ï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- **è§£è€¦**: ç”¨æˆ·å±‚ä¸æ„ŸçŸ¥å…·ä½“ä¾›åº”å•†
- **çµæ´»**: å¯é€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢ä¾›åº”å•†
- **æ‰©å±•**: æ–°å¢ä¾›åº”å•†/æ¨¡å‹æ— éœ€ä¿®æ”¹å‰ç«¯
- **ç»´æŠ¤**: æ˜ å°„é…ç½®é›†ä¸­ç®¡ç†

---

## ğŸ“¦ æ ¸å¿ƒæ–‡ä»¶ä¸èŒè´£

| æ–‡ä»¶ | èŒè´£ | å…³é”®å†…å®¹ |
|------|------|----------|
| `src/ai/types.ts` | ç±»å‹å®šä¹‰ | `AIVideoProvider` æ¥å£ã€å‚æ•°ç»“æ„ |
| `src/ai/model-mapping.ts` | æ˜ å°„é…ç½® | `MODEL_MAPPINGS`ã€å‚æ•°è½¬æ¢å‡½æ•° |
| `src/ai/providers/*.ts` | Provider å®ç° | å„ä¾›åº”å•†çš„ API è°ƒç”¨é€»è¾‘ |
| `src/ai/index.ts` | Provider å·¥å‚ | `getProvider()` å·¥å‚æ–¹æ³• |
| `src/services/video.ts` | ä¸šåŠ¡æœåŠ¡ | è°ƒç”¨ Provider ç”Ÿæˆè§†é¢‘ |
| `src/config/credits.ts` | è®¡è´¹é…ç½® | æ¨¡å‹ç§¯åˆ†è®¡ç®—è§„åˆ™ |

---

## ğŸ¯ æ¥å…¥æ–° Provider æµç¨‹

### ç¬¬1æ­¥ï¼šåˆ†æä¾›åº”å•† API

éœ€è¦æ”¶é›†çš„ä¿¡æ¯ï¼š

| ä¿¡æ¯é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| **API åŸºåœ°å€** | API endpoint å‰ç¼€ | `https://api.example.com/v1` |
| **è®¤è¯æ–¹å¼** | API Key ä¼ é€’æ–¹å¼ | `Authorization: Bearer {key}` |
| **åˆ›å»ºä»»åŠ¡ç«¯ç‚¹** | POST è·¯å¾„ | `/videos/generations` |
| **æŸ¥è¯¢çŠ¶æ€ç«¯ç‚¹** | GET è·¯å¾„ | `/tasks/{task_id}` |
| **è¯·æ±‚æ ¼å¼** | Content-Type | `application/json` |
| **å“åº”æ ¼å¼** | è¿”å›æ•°æ®ç»“æ„ | `{ task_id, status, video_url }` |
| **æ¨¡å‹ ID** | å„æ¨¡å‹çš„æ ‡è¯† | `model-v1`, `model-v2` |
| **å‚æ•°æ˜ å°„** | ä¾›åº”å•†å‚æ•°å | `prompt`, `aspect_ratio`, `duration` |
| **ç‰¹æ®Šç«¯ç‚¹** | æŸäº›æ¨¡å‹çš„ç‹¬ç«‹ç«¯ç‚¹ | `/api/v1/special-model/generate` |
| **å›è°ƒæ ¼å¼** | Webhook æ•°æ®ç»“æ„ | `{ task_id, status, result }` |

### ç¬¬2æ­¥ï¼šå®ç° Provider ç±»

**æ–‡ä»¶ä½ç½®**: `src/ai/providers/{provider-name}.ts`

**ç±»ç»“æ„**ï¼š
```
{ProviderName}Provider implements AIVideoProvider
â”œâ”€â”€ name: string                    # Provider æ ‡è¯†ï¼ˆå¦‚ "evolink"ï¼‰
â”œâ”€â”€ supportImageToVideo: boolean    # æ˜¯å¦æ”¯æŒå›¾ç”Ÿè§†é¢‘
â”œâ”€â”€ apiKey: string                  # API å¯†é’¥
â”œâ”€â”€ baseUrl: string                 # API åŸºåœ°å€
â”œâ”€â”€ constructor(apiKey)             # åˆå§‹åŒ–
â”œâ”€â”€ createTask(params)              # åˆ›å»ºç”Ÿæˆä»»åŠ¡
â”œâ”€â”€ getTaskStatus(taskId)           # æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
â””â”€â”€ parseCallback(payload)          # è§£æå›è°ƒæ•°æ®
```

**æ–¹æ³•è§„èŒƒ**ï¼š

#### `createTask(params)`
- **è¾“å…¥**: `VideoGenerationParams` (ç»Ÿä¸€å‚æ•°æ ¼å¼)
- **è¾“å‡º**: `VideoTaskResponse` (åŒ…å« taskId, status, raw)
- **èŒè´£**:
  1. è°ƒç”¨ `getProviderModelId()` è·å–ä¾›åº”å•†æ¨¡å‹ ID
  2. è°ƒç”¨ `transformParamsForProvider()` è½¬æ¢å‚æ•°
  3. å‘é€ POST è¯·æ±‚åˆ°ä¾›åº”å•† API
  4. è¿”å›ç»Ÿä¸€æ ¼å¼çš„ä»»åŠ¡å“åº”

#### `getTaskStatus(taskId)`
- **è¾“å…¥**: taskId (string)
- **è¾“å‡º**: `VideoTaskResponse` (åŒ…å« status, videoUrl, error)
- **èŒè´£**:
  1. å‘é€ GET è¯·æ±‚æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
  2. **å¿…é¡»å¤„ç†**ç‰¹æ®Š HTTP çŠ¶æ€ç ï¼š
     - `404/410` â†’ è¿”å› `status: "failed"` (ä»»åŠ¡ä¸å­˜åœ¨)
     - `429` â†’ æŠ›å‡ºå‹å¥½é”™è¯¯ (é€Ÿç‡é™åˆ¶)
     - `401/403` â†’ æŠ›å‡ºå‹å¥½é”™è¯¯ (è®¤è¯å¤±è´¥)
  3. æ˜ å°„ä¾›åº”å•†çŠ¶æ€åˆ°ç»Ÿä¸€çŠ¶æ€
  4. æå– videoUrlã€thumbnailUrl

#### `parseCallback(payload)`
- **è¾“å…¥**: Webhook å›è°ƒæ•°æ® (any)
- **è¾“å‡º**: `VideoTaskResponse`
- **èŒè´£**:
  1. è§£æä¾›åº”å•†å›è°ƒæ ¼å¼
  2. æå– taskIdã€statusã€videoUrl
  3. æ˜ å°„åˆ°ç»Ÿä¸€å“åº”æ ¼å¼

### ç¬¬3æ­¥ï¼šæ·»åŠ  Provider ç±»å‹

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
1. `src/ai/model-mapping.ts` - æ·»åŠ åˆ° `ProviderType`
2. `src/ai/types.ts` - æ·»åŠ åˆ° `VideoTaskResponse["provider"]`
3. `src/ai/index.ts` - åœ¨ `getProvider()` å·¥å‚æ–¹æ³•ä¸­æ³¨å†Œ

**ç±»å‹å®šä¹‰ä½ç½®**ï¼š
```typescript
// src/ai/model-mapping.ts
export type ProviderType = "evolink" | "kie" | "new-provider";

// src/ai/types.ts
export interface VideoTaskResponse {
  provider: "evolink" | "kie" | "new-provider";
}
```

### ç¬¬4æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨ `.env.local` æ·»åŠ ï¼š
```bash
{PROVIDER_NAME}_API_KEY=your_api_key_here
```

**å‘½åè§„èŒƒ**: å…¨å¤§å†™ + `_API_KEY` åç¼€

### ç¬¬5æ­¥ï¼šæ·»åŠ æ¨¡å‹æ˜ å°„é…ç½®

åœ¨ `src/ai/model-mapping.ts` çš„ `MODEL_MAPPINGS` ä¸­æ·»åŠ é…ç½®ã€‚

---

---

## ğŸ”§ å‚æ•°è½¬æ¢è§„èŒƒ

### ç»Ÿä¸€å‚æ•° vs ä¾›åº”å•†å‚æ•°

**ç»Ÿä¸€å‚æ•°** (VideoGenerationParams):
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `model` | string | å†…éƒ¨æ¨¡å‹ IDï¼ˆå¦‚ "sora-2"ï¼‰ |
| `prompt` | string | æ–‡æœ¬æç¤ºè¯ |
| `aspectRatio` | string | å®½é«˜æ¯”ï¼ˆ"16:9", "9:16"ï¼‰ |
| `duration` | number | æ—¶é•¿ï¼ˆç§’ï¼‰ |
| `quality` | string | è´¨é‡ï¼ˆ"standard", "high", "720p", "1080p"ï¼‰ |
| `imageUrl` | string | å•å›¾ URLï¼ˆå›¾ç”Ÿè§†é¢‘ï¼‰ |
| `imageUrls` | string[] | å¤šå›¾ URL æ•°ç»„ |
| `mode` | string | ç”Ÿæˆæ¨¡å¼ï¼ˆå¦‚ "reference-to-video"ï¼‰ |
| `callbackUrl` | string | å›è°ƒ URL |
| `removeWatermark` | boolean | æ˜¯å¦å»æ°´å° |

**ä¾›åº”å•†å‚æ•°è½¬æ¢ç¤ºä¾‹**:

| ç»Ÿä¸€å‚æ•° | Evolink | KIE | è¯´æ˜ |
|---------|---------|-----|------|
| `prompt` | `prompt` | `input.prompt` | KIE éœ€åµŒå¥—åœ¨ input ä¸­ |
| `aspectRatio` | `aspect_ratio` | `input.aspect_ratio` | éƒ½ç”¨ä¸‹åˆ’çº¿ |
| `duration` | `10` (number) | `"10"` (string) | KIE å¿…é¡»æ˜¯å­—ç¬¦ä¸² |
| `quality` | `"720p"` | æ··åˆ | è§ä¸‹è¡¨ |
| `imageUrl` | `image_urls[]` | `image_urls[]` / `input_urls[]` | Seedance ç”¨ input_urls |
| `callbackUrl` | `callback_url` | `callBackUrl` | KIE ç”¨é©¼å³° |

### è´¨é‡å‚æ•°è½¬æ¢è§„åˆ™

| ç»Ÿä¸€å€¼ | Evolink | KIE Sora 2 | KIE å…¶ä»– | è¯´æ˜ |
|--------|---------|-----------|----------|------|
| `"standard"` | `"720p"` | `"standard"` | `"720p"` | Sora ç”¨ç‰¹æ®Šå€¼ |
| `"high"` | `"1080p"` | `"high"` | `"1080p"` | Sora ç”¨ç‰¹æ®Šå€¼ |
| `"480P"` | `"480p"` | `"standard"` | `"480p"` | éœ€å¤§å°å†™è½¬æ¢ |
| `"720P"` | `"720p"` | `"standard"` | `"720p"` | éœ€å¤§å°å†™è½¬æ¢ |
| `"1080P"` | `"1080p"` | `"high"` | `"1080p"` | éœ€å¤§å°å†™è½¬æ¢ |

**è½¬æ¢å‡½æ•°**: `normalizeQuality(value, provider, internalModelId)`
- ä½ç½®: `src/ai/model-mapping.ts`
- èŒè´£: ç»Ÿä¸€ä¸åŒè´¨é‡æšä¸¾åˆ°ä¾›åº”å•†æ ¼å¼

### å‚æ•°è½¬æ¢ç­–ç•¥

**1. å‘½åé£æ ¼è½¬æ¢**:
- ç»Ÿä¸€å‚æ•°: camelCase (`aspectRatio`, `callbackUrl`)
- ä¾›åº”å•†: æ··åˆï¼ˆsnake_case / camelCaseï¼‰

**2. æ•°æ®ç±»å‹è½¬æ¢**:
- `duration`: number (ç»Ÿä¸€) â†’ string (æŸäº›ä¾›åº”å•†)
- `imageUrl`: string (å•å›¾) â†’ `imageUrls[]` (æ•°ç»„)

**3. ç»“æ„åµŒå¥—**:
- æŸäº›ä¾›åº”å•†éœ€è¦å‚æ•°åµŒå¥—åœ¨ `input` å¯¹è±¡ä¸­
- ç¤ºä¾‹: KIE éœ€è¦ `{ input: { prompt: "..." } }`

**4. æ¨¡å‹ç‰¹å®šå‚æ•°**:
- ä¸åŒæ¨¡å‹å¯¹åŒä¸€å‚æ•°å¯èƒ½æœ‰ä¸åŒå‘½å
- ç¤ºä¾‹: Sora 2 ç”¨ `size` è¡¨ç¤ºè´¨é‡ï¼Œå…¶ä»–æ¨¡å‹ç”¨ `resolution`

**è½¬æ¢å‡½æ•°**: `transformParamsForProvider(internalModelId, provider, params)`
- ä½ç½®: `src/ai/model-mapping.ts`
- èŒè´£: æ ¹æ®ä¾›åº”å•†å’Œæ¨¡å‹è½¬æ¢å‚æ•°æ ¼å¼

---

## ğŸ”Œ æ¨¡å‹æ˜ å°„é…ç½®ç»“æ„

### MODEL_MAPPINGS æ•°æ®ç»“æ„

```typescript
MODEL_MAPPINGS: Record<string, ModelMapping>
```

**ModelMapping ç»“æ„**:
```
{
  internalId: string           # å†…éƒ¨ç»Ÿä¸€ IDï¼ˆå¦‚ "sora-2"ï¼‰
  displayName: string          # æ˜¾ç¤ºåç§°ï¼ˆå¦‚ "Sora 2"ï¼‰
  providers: {
    [providerName]: {
      providerModelId: string | function   # ä¾›åº”å•†æ¨¡å‹ ID
      apiEndpoint?: string                 # å¯é€‰ï¼šç‰¹æ®Šç«¯ç‚¹
      supported: boolean                   # æ˜¯å¦æ”¯æŒ
      transformParams?: function           # è‡ªå®šä¹‰è½¬æ¢å‡½æ•°
    }
  }
}
```

### providerModelId çš„ä¸¤ç§å½¢å¼

**1. é™æ€å­—ç¬¦ä¸²** (æ¨¡å‹ ID å›ºå®š):
```typescript
providerModelId: "sora-2"
```

**2. åŠ¨æ€å‡½æ•°** (æ ¹æ®å‚æ•°é€‰æ‹©æ¨¡å‹):
```typescript
providerModelId: (params) => {
  // æ ¹æ®å‚æ•°åŠ¨æ€è¿”å›ä¸åŒçš„æ¨¡å‹ ID
  if (params.mode === "reference-to-video") {
    return "model-reference-video";
  }
  return params.imageUrl
    ? "model-image-to-video"
    : "model-text-to-video";
}
```

**ä½¿ç”¨åœºæ™¯**:
- æ–‡ç”Ÿè§†é¢‘ vs å›¾ç”Ÿè§†é¢‘ä½¿ç”¨ä¸åŒæ¨¡å‹ ID
- ä¸åŒè´¨é‡ä½¿ç”¨ä¸åŒæ¨¡å‹ï¼ˆå¦‚ Veo 3.1 çš„ veo3 vs veo3_fastï¼‰
- ä¸åŒæ¨¡å¼ä½¿ç”¨ä¸åŒæ¨¡å‹ï¼ˆå¦‚ Wan 2.6 çš„ reference-videoï¼‰

### apiEndpoint çš„ä½¿ç”¨

**é»˜è®¤ç«¯ç‚¹**: å¤§å¤šæ•°æ¨¡å‹ä½¿ç”¨ä¾›åº”å•†çš„æ ‡å‡†ç«¯ç‚¹
**ç‰¹æ®Šç«¯ç‚¹**: æŸäº›æ¨¡å‹éœ€è¦ç‹¬ç«‹ç«¯ç‚¹ï¼ˆå¦‚ KIE Veo 3.1ï¼‰

ç¤ºä¾‹:
```typescript
apiEndpoint: "/api/v1/veo/generate"  # Veo 3.1 ç‹¬ç«‹ç«¯ç‚¹
```

Provider å®ç°ä¸­éœ€å¤„ç†:
```typescript
const apiEndpoint = providerConfig?.apiEndpoint || "/api/v1/jobs/createTask";
const response = await fetch(`${this.baseUrl}${apiEndpoint}`, ...);
```

---

## âœ… å½“å‰å·²æ¥å…¥æ¨¡å‹å¯¹ç…§

> **å”¯ä¸€äº‹å®æº**: `src/ai/model-mapping.ts`
> ä¸‹é¢æ˜¯å½“å‰é¡¹ç›®å·²æ¥å…¥æ¨¡å‹çš„å®Œæ•´å¯¹ç…§å…³ç³»ï¼ˆå«åŠ¨æ€é€‰æ‹©è§„åˆ™å’Œå‚è€ƒæ–‡æ¡£ï¼‰ã€‚

### æ¨¡å‹æ˜ å°„æ€»è§ˆ

| ç»Ÿä¸€æ¨¡å‹ ID | Evolink æ¨¡å‹ ID | KIE æ¨¡å‹ ID | ç‰¹æ®Šç«¯ç‚¹ | å‚è€ƒæ–‡æ¡£ |
|-------------|----------------|-------------|----------|----------|
| **sora-2** | `sora-2` | `sora-2-text-to-video`<br/>`sora-2-image-to-video` | âŒ é»˜è®¤ç«¯ç‚¹ | KIE: [æ–‡ç”Ÿ](../API_KIE/sora-2-text-to-video.md) \| [å›¾ç”Ÿ](../API_KIE/sora-2-image-to-video.md)<br/>Evolink: [PRICING.md](./PRICING.md) |
| **wan2.6** | `wan2.6-text-to-video`<br/>`wan2.6-image-to-video`<br/>`wan2.6-reference-video` | `wan/2-6-text-to-video`<br/>`wan/2-6-image-to-video`<br/>`wan/2-6-video-to-video` | âŒ é»˜è®¤ç«¯ç‚¹ | KIE: [æ–‡ç”Ÿ](../API_KIE/wan/2-6-text-to-video.md) \| [å›¾ç”Ÿ](../API_KIE/wan/2-6-image-to-video.md) \| [å‚è€ƒè§†é¢‘](../API_KIE/wan/2-6-video-to-video.md)<br/>Evolink: [PRICING.md](./PRICING.md) |
| **veo-3.1** | `veo3.1-fast` | `veo3_fast` \| `veo3` | âœ… **KIE**: `/api/v1/veo/generate` | KIE: [veo-3.1.md](../API_KIE/veo-3-1.md)<br/>Evolink: [PRICING.md](./PRICING.md) |
| **seedance-1.5-pro** | `seedance-1.5-pro` | `bytedance/seedance-1.5-pro` | âŒ é»˜è®¤ç«¯ç‚¹ | KIE: [seedance-1.5-pro.md](../API_KIE/bytedance/seedance-1.5-pro.md)<br/>Evolink: [PRICING.md](./PRICING.md) |

### åŠ¨æ€æ¨¡å‹é€‰æ‹©è§„åˆ™

#### Sora 2
- **KIE**: æ ¹æ® `imageUrl` æˆ– `imageUrls` æ˜¯å¦å­˜åœ¨è‡ªåŠ¨é€‰æ‹©
  - æœ‰å›¾ç‰‡ â†’ `sora-2-image-to-video`
  - æ— å›¾ç‰‡ â†’ `sora-2-text-to-video`
- **Evolink**: å›ºå®šä½¿ç”¨ `sora-2`

#### Wan 2.6
- **Evolink**: ä¸‰ç§æ¨¡å¼
  - `mode === "reference-to-video"` â†’ `wan2.6-reference-video`
  - æœ‰ `imageUrl` æˆ– `imageUrls` â†’ `wan2.6-image-to-video`
  - å¦åˆ™ â†’ `wan2.6-text-to-video`
- **KIE**: ä¸‰ç§æ¨¡å¼ï¼ˆå¯¹åº” Evolinkï¼‰
  - `mode === "reference-to-video"` â†’ `wan/2-6-video-to-video`
  - æœ‰å›¾ç‰‡ â†’ `wan/2-6-image-to-video`
  - å¦åˆ™ â†’ `wan/2-6-text-to-video`

#### Veo 3.1
- **Evolink**: å›ºå®šä½¿ç”¨ `veo3.1-fast`
- **KIE**: æ ¹æ® `quality` åŠ¨æ€é€‰æ‹©
  - `quality === "high"` æˆ– `"1080p"` æˆ– `"4k"` â†’ `veo3`ï¼ˆè´¨é‡ç‰ˆï¼‰
  - å¦åˆ™ â†’ `veo3_fast`ï¼ˆå¿«é€Ÿç‰ˆï¼‰
- **ç‰¹æ®Šç«¯ç‚¹**: KIE ä½¿ç”¨ `/api/v1/veo/generate`ï¼ˆç‹¬ç«‹äºæ ‡å‡†ç«¯ç‚¹ï¼‰

#### Seedance 1.5 Pro
- **Evolink**: å›ºå®šä½¿ç”¨ `seedance-1.5-pro`
- **KIE**: å›ºå®šä½¿ç”¨ `bytedance/seedance-1.5-pro`

### API ç«¯ç‚¹å¯¹ç…§

| Provider | æ ‡å‡†ç«¯ç‚¹ | Veo 3.1 ç«¯ç‚¹ |
|----------|---------|-------------|
| **Evolink** | `/v1/videos/generations` | `/v1/videos/generations`ï¼ˆç›¸åŒï¼‰ |
| **KIE** | `/api/v1/jobs/createTask` | `/api/v1/veo/generate` âš ï¸ **ä¸åŒ** |

### Evolink å¤–éƒ¨é“¾æ¥

> Evolink è¯¦æƒ…é¡µé›†ä¸­åœ¨ `docs/spec/PRICING.md`ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤ä»·æ ¼ä¸è§„æ ¼ã€‚

- Sora 2: https://evolink.ai/zh/sora-2
- Wan 2.6: https://evolink.ai/zh/wan-2-6
- Veo 3.1 Fast Lite: https://evolink.ai/zh/veo-3-1?model=veo-3-1-fast-lite
- Seedance 1.5 Pro: https://evolink.ai/zh/seedance-1-5-pro

### å‚æ•°å·®å¼‚é€ŸæŸ¥

| ç»Ÿä¸€å‚æ•° | Evolink é€šç”¨ | KIE Sora 2 | KIE Wan 2.6 | KIE Veo 3.1 | KIE Seedance |
|---------|------------|-----------|------------|------------|-------------|
| `prompt` | `prompt` | `input.prompt` | `input.prompt` | `prompt` âš ï¸ | `input.prompt` |
| `aspectRatio` | `aspect_ratio` | `input.aspect_ratio` | `input.aspect_ratio` | `aspect_ratio` âš ï¸ | `input.aspect_ratio` |
| `duration` | `10` (number) | `n_frames` (string) âš ï¸ | `input.duration` (string) | âŒ ä¸æ”¯æŒ | `input.duration` (string) |
| `quality` | `quality` | `size` (standard/high) âš ï¸ | `input.resolution` (720p/1080p) | âŒ ä¸æ”¯æŒ | `input.resolution` (720p/1080p) |
| `imageUrl` | `image_urls[]` | `image_urls[]` | `image_urls[]` | `imageUrls[]` âš ï¸ | `input_urls[]` âš ï¸ |
| `callbackUrl` | `callback_url` | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ | `callBackUrl` âš ï¸ | âŒ ä¸æ”¯æŒ |

**æ³¨**: âš ï¸ è¡¨ç¤ºè¯¥æ¨¡å‹æœ‰ç‰¹æ®Šå¤„ç†

---

### HTTP çŠ¶æ€ç å¤„ç†

| çŠ¶æ€ç  | å«ä¹‰ | å¤„ç†æ–¹å¼ | è¿”å›/æŠ›å‡º |
|--------|------|----------|-----------|
| `404` | ä»»åŠ¡ä¸å­˜åœ¨ | è¿”å› failed çŠ¶æ€ | `{ status: "failed", error: {...} }` |
| `410` | ä»»åŠ¡å·²è¿‡æœŸ | è¿”å› failed çŠ¶æ€ | `{ status: "failed", error: {...} }` |
| `429` | é€Ÿç‡é™åˆ¶ | æŠ›å‡ºå‹å¥½é”™è¯¯ | `throw new Error("Rate limit exceeded...")` |
| `401` | è®¤è¯å¤±è´¥ | æŠ›å‡ºå‹å¥½é”™è¯¯ | `throw new Error("Authentication failed...")` |
| `403` | æƒé™ä¸è¶³ | æŠ›å‡ºå‹å¥½é”™è¯¯ | `throw new Error("Authentication failed...")` |
| `å…¶ä»–` | é€šç”¨é”™è¯¯ | æŠ›å‡ºåŸå§‹ä¿¡æ¯ | `throw new Error(\`API error (${status})\`)` |

**å…³é”®åŸåˆ™**:
- âœ… 404/410 **ä¸åº”æŠ›å‡ºé”™è¯¯**ï¼Œåº”è¿”å› failed çŠ¶æ€ï¼ˆé¿å…ä»»åŠ¡ä¸¢å¤±ï¼‰
- âœ… 429 åº”æç¤ºé‡è¯•
- âœ… 401/403 åº”æç¤ºæ£€æŸ¥ API Key
- âœ… ä¿ç•™åŸå§‹é”™è¯¯ä¿¡æ¯åœ¨ `raw` å­—æ®µä¸­

### JSON è§£æé˜²å´©

**åœºæ™¯**: ä¾›åº”å•†è¿”å›çš„ JSON å­—æ®µï¼ˆå¦‚ `resultJson`ï¼‰å¯èƒ½æ˜¯éæ³• JSON

**å¤„ç†ç­–ç•¥**:
```typescript
// âœ… ä½¿ç”¨ try-catch ä¿æŠ¤
try {
  const parsed = JSON.parse(data.resultJson);
  videoUrl = parsed.resultUrls[0];
} catch (error) {
  console.error("Failed to parse resultJson:", error);
  // ä¸ä¸­æ–­æµç¨‹ï¼Œè¿”å› undefined
}
```

**å¤šæ ¼å¼æ”¯æŒ**: æŸäº›å­—æ®µå¯èƒ½æ˜¯æ•°ç»„æˆ– JSON å­—ç¬¦ä¸²
```typescript
private pickFirstUrl(value: unknown): string | undefined {
  if (Array.isArray(value)) return value[0];      // ç›´æ¥æ˜¯æ•°ç»„
  if (typeof value === "string") {
    try {
      const parsed = JSON.parse(value);           // JSON å­—ç¬¦ä¸²
      if (Array.isArray(parsed)) return parsed[0];
    } catch { /* ignore */ }
  }
  return undefined;
}
```

### çŠ¶æ€æ˜ å°„

**ç»Ÿä¸€çŠ¶æ€æšä¸¾**: `"pending"`, `"processing"`, `"completed"`, `"failed"`

**ä¾›åº”å•†çŠ¶æ€æ˜ å°„**ï¼ˆç¤ºä¾‹ï¼‰:
| ä¾›åº”å•†çŠ¶æ€ | ç»Ÿä¸€çŠ¶æ€ |
|-----------|----------|
| `queued`, `pending` | `pending` |
| `processing`, `generating` | `processing` |
| `completed`, `succeeded`, `done` | `completed` |
| `failed`, `error`, `cancelled` | `failed` |

**æ˜ å°„æ–¹æ³•**: `mapStatus(status: string)` ç§æœ‰æ–¹æ³•

---

## ğŸ¯ æ·»åŠ æ–°æ¨¡å‹æµç¨‹

### æ·»åŠ å†…éƒ¨æ¨¡å‹ï¼ˆå·²å­˜åœ¨çš„ Providerï¼‰

**åœºæ™¯**: åœ¨ç°æœ‰ Providerï¼ˆå¦‚ Evolink/KIEï¼‰ä¸‹æ·»åŠ æ–°æ¨¡å‹

**æ­¥éª¤**:
1. åœ¨ `MODEL_MAPPINGS` æ·»åŠ æ¨¡å‹é…ç½®
2. åœ¨ `src/config/credits.ts` æ·»åŠ è®¡è´¹è§„åˆ™
3. åœ¨ `src/components/video-generator/defaults.ts` æ·»åŠ å‰ç«¯æ¨¡å‹å®šä¹‰

### æ¨¡å‹æ˜ å°„é…ç½®

**ä½ç½®**: `src/ai/model-mapping.ts` çš„ `MODEL_MAPPINGS`

**é…ç½®è¦ç‚¹**:
| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `internalId` | ç»Ÿä¸€æ¨¡å‹ ID | `"new-model"` |
| `displayName` | æ˜¾ç¤ºåç§° | `"New Model"` |
| `providers.{provider}.providerModelId` | ä¾›åº”å•†æ¨¡å‹ ID | `"model-v1"` æˆ–å‡½æ•° |
| `providers.{provider}.supported` | æ˜¯å¦æ”¯æŒ | `true` |
| `providers.{provider}.transformParams` | å‚æ•°è½¬æ¢å‡½æ•° | å¤ç”¨æˆ–è‡ªå®šä¹‰ |

### è®¡è´¹é…ç½®

**ä½ç½®**: `src/config/credits.ts`

**é…ç½®ç»“æ„**:
```typescript
models: {
  "new-model": {
    id: "new-model",
    name: "New Model",
    provider: "evolink" | "kie",
    supportImageToVideo: boolean,
    durations: number[],              # æ”¯æŒçš„æ—¶é•¿
    aspectRatios: string[],           # æ”¯æŒçš„å®½é«˜æ¯”
    creditCost: {
      base: number,                   # åŸºç¡€ç§¯åˆ†
      perExtraSecond?: number,        # æ¯ç§’é¢å¤–ç§¯åˆ†
      highQualityMultiplier?: number, # é«˜è´¨é‡å€æ•°
    },
  },
}
```

### å‰ç«¯æ¨¡å‹å®šä¹‰

**ä½ç½®**: `src/components/video-generator/defaults.ts`

**é…ç½®ç»“æ„**:
```typescript
{
  id: "new-model",
  name: "New Model",
  description: "Model description",
  creditCost: number,                # åŸºç¡€ç§¯åˆ†
  durations: string[],               # ["5s", "10s", "15s"]
  resolutions: string[],             # ["720P", "1080P"]
  aspectRatios: string[],            # ["16:9", "9:16"]
  supportImageToVideo: boolean,
}
```

---

## âš ï¸ ç‰¹æ®Šåœºæ™¯å¤„ç†

### 1. ç‹¬ç«‹ç«¯ç‚¹çš„æ¨¡å‹

**ç‰¹å¾**: æŸäº›æ¨¡å‹ä½¿ç”¨ä¸æ ‡å‡†ç«¯ç‚¹ä¸åŒçš„ API è·¯å¾„

**ç¤ºä¾‹**: KIE Veo 3.1 ä½¿ç”¨ `/api/v1/veo/generate`

**é…ç½®æ–¹å¼**:
```typescript
providers: {
  kie: {
    apiEndpoint: "/api/v1/veo/generate",  # ç‰¹æ®Šç«¯ç‚¹
    // ...
  }
}
```

**Provider å®ç°**: éœ€åœ¨ `createTask` ä¸­è¯»å–å¹¶ä½¿ç”¨ `apiEndpoint`

### 2. ç‰¹æ®Šå›è°ƒæ ¼å¼

**ç‰¹å¾**: Webhook å›è°ƒæ•°æ®æ ¼å¼ä¸å…¶ä»–æ¨¡å‹ä¸åŒ

**ç¤ºä¾‹**: KIE Veo 3.1 å›è°ƒä¸­è§†é¢‘ URL åœ¨ `data.info.resultUrls`

**å¤„ç†æ–¹å¼**:
- åœ¨ `parseCallback` ä¸­æ£€æµ‹ç‰¹æ®Šæ ¼å¼
- åœ¨ `getTaskStatus` ä¸­ä½¿ç”¨ä¸åŒè§£æé€»è¾‘
- ä½¿ç”¨è¾…åŠ©æ–¹æ³• `pickFirstUrl()` å¤„ç†å¤šç§æ ¼å¼

**æ£€æµ‹æ–¹æ³•**:
```typescript
// æ–¹æ³•1: æ ¹æ®ä»»åŠ¡ ID å‰ç¼€åˆ¤æ–­
if (taskId.startsWith("veo_task_")) {
  return this.parseVeoCallback(payload);
}

// æ–¹æ³•2: æ ¹æ®å›è°ƒæ•°æ®ç»“æ„åˆ¤æ–­
if (payload.data?.info?.resultUrls) {
  return this.parseSpecialFormat(payload);
}
```

### 3. åŠ¨æ€æ¨¡å‹é€‰æ‹©

**ç‰¹å¾**: æ ¹æ®å‚æ•°é€‰æ‹©ä¸åŒçš„ä¾›åº”å•†æ¨¡å‹ ID

**é…ç½®æ–¹å¼**:
```typescript
providerModelId: (params) => {
  // æ ¹æ®ç”Ÿæˆæ¨¡å¼é€‰æ‹©
  if (params.mode === "reference-to-video") {
    return "model-reference-video";
  }

  // æ ¹æ®æ˜¯å¦æœ‰å›¾ç‰‡é€‰æ‹©
  if (params.imageUrl || params.imageUrls?.length) {
    return "model-image-to-video";
  }

  // æ ¹æ®è´¨é‡é€‰æ‹©
  if (params.quality === "high") {
    return "model-hd";
  }

  return "model-default";
}
```

**ä½¿ç”¨åœºæ™¯**:
- æ–‡ç”Ÿè§†é¢‘ vs å›¾ç”Ÿè§†é¢‘
- ä¸åŒè´¨é‡ç‰ˆæœ¬ï¼ˆveo3 vs veo3_fastï¼‰
- ä¸åŒç”Ÿæˆæ¨¡å¼

### 4. å¤šå›¾ç‰‡ URL å¤„ç†

**ç‰¹å¾**: ä¾›åº”å•†å¯¹å•å›¾/å¤šå›¾æœ‰ä¸åŒå‚æ•°å

**ç»Ÿä¸€å‚æ•°**:
- `imageUrl`: å•å›¾ URLï¼ˆå‘åå…¼å®¹ï¼‰
- `imageUrls`: å¤šå›¾ URL æ•°ç»„

**è½¬æ¢ç­–ç•¥**:
```typescript
// ç»Ÿä¸€å¤„ç†ä¸º imageUrls æ•°ç»„
const imageUrls = Array.isArray(params.imageUrls)
  ? params.imageUrls
  : params.imageUrl
    ? [params.imageUrl]
    : undefined;

// æ ¹æ®ä¾›åº”å•†è¦æ±‚ä¼ é€’
if (imageUrls && imageUrls.length > 0) {
  result.image_urls = imageUrls;           // å¤šå›¾æ”¯æŒ
  result.image_url = imageUrls[0];         // åªæ”¯æŒå•å›¾
}
```

---

## ğŸ§ª é›†æˆæµ‹è¯•æ¸…å•

### Provider åŠŸèƒ½æµ‹è¯•

- [ ] åˆ›å»ºä»»åŠ¡æˆåŠŸï¼ˆè¿”å› taskIdï¼‰
- [ ] æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€æ­£å¸¸
- [ ] Webhook å›è°ƒè§£ææ­£ç¡®
- [ ] è§†é¢‘é“¾æ¥æå–æˆåŠŸ

### å‚æ•°è½¬æ¢æµ‹è¯•

- [ ] æ–‡ç”Ÿè§†é¢‘ï¼ˆprompt + duration + aspectRatioï¼‰
- [ ] å›¾ç”Ÿè§†é¢‘ï¼ˆprompt + imageUrlï¼‰
- [ ] å¤šå›¾ç”Ÿæˆï¼ˆprompt + imageUrlsï¼‰
- [ ] è´¨é‡å‚æ•°ï¼ˆquality æ˜ å°„æ­£ç¡®ï¼‰
- [ ] å»æ°´å°å‚æ•°ï¼ˆremoveWatermarkï¼‰
- [ ] å›è°ƒ URLï¼ˆcallbackUrl ä¼ é€’ï¼‰

### é”™è¯¯å¤„ç†æµ‹è¯•

- [ ] 404 ä»»åŠ¡ä¸å­˜åœ¨ï¼ˆè¿”å› failedï¼Œä¸æŠ›é”™ï¼‰
- [ ] 429 é€Ÿç‡é™åˆ¶ï¼ˆå‹å¥½é”™è¯¯æç¤ºï¼‰
- [ ] 401/403 è®¤è¯å¤±è´¥ï¼ˆæç¤ºæ£€æŸ¥ API Keyï¼‰
- [ ] éæ³• JSON è§£æï¼ˆé˜²å´©å¤„ç†ï¼‰
- [ ] ç½‘ç»œè¶…æ—¶ï¼ˆé”™è¯¯æç¤ºï¼‰

### å¤šæ¨¡å‹æµ‹è¯•

- [ ] å„æ¨¡å‹çš„ providerModelId æ­£ç¡®
- [ ] åŠ¨æ€æ¨¡å‹é€‰æ‹©ï¼ˆåŸºäºå‚æ•°ï¼‰
- [ ] ç‰¹æ®Šç«¯ç‚¹æ¨¡å‹ï¼ˆå¦‚ Veo 3.1ï¼‰
- [ ] ä¸åŒæ¨¡å‹çš„å‚æ•°è½¬æ¢

### åˆ‡æ¢ä¾›åº”å•†æµ‹è¯•

```bash
# ç¯å¢ƒå˜é‡åˆ‡æ¢
DEFAULT_AI_PROVIDER=new-provider

# éªŒè¯ï¼š
# - ä»»åŠ¡åˆ›å»ºä½¿ç”¨æ–° Provider
# - çŠ¶æ€æŸ¥è¯¢ä½¿ç”¨æ–° Provider
# - å›è°ƒè§£æä½¿ç”¨æ–° Provider
```

---

## ğŸ“š å…³é”®æ•°æ®ç»“æ„

### VideoGenerationParams (ç»Ÿä¸€å‚æ•°)

```typescript
interface VideoGenerationParams {
  model?: string;              # å†…éƒ¨æ¨¡å‹ ID
  prompt: string;              # æ–‡æœ¬æç¤ºè¯
  aspectRatio?: string;        # å®½é«˜æ¯”: "16:9", "9:16"
  duration?: number;           # æ—¶é•¿ï¼ˆç§’ï¼‰
  quality?: string;            # è´¨é‡: "standard", "high", "720p", "1080P"
  imageUrl?: string;           # å•å›¾ URL
  imageUrls?: string[];        # å¤šå›¾ URL
  mode?: string;               # ç”Ÿæˆæ¨¡å¼
  outputNumber?: number;       # è¾“å‡ºæ•°é‡
  generateAudio?: boolean;     # æ˜¯å¦ç”ŸæˆéŸ³é¢‘
  removeWatermark?: boolean;   # æ˜¯å¦å»æ°´å°
  callbackUrl?: string;        # å›è°ƒ URL
}
```

### VideoTaskResponse (ç»Ÿä¸€å“åº”)

```typescript
interface VideoTaskResponse {
  taskId: string;              # ä»»åŠ¡ ID
  provider: string;            # ä¾›åº”å•†åç§°
  status: "pending" | "processing" | "completed" | "failed";
  progress?: number;           # è¿›åº¦ 0-100
  estimatedTime?: number;      # é¢„è®¡æ—¶é—´ï¼ˆç§’ï¼‰
  videoUrl?: string;           # è§†é¢‘ URL
  thumbnailUrl?: string;       # ç¼©ç•¥å›¾ URL
  error?: {                    # é”™è¯¯ä¿¡æ¯
    code: string;
    message: string;
  };
  raw?: any;                   # åŸå§‹å“åº”
}
```

### AIVideoProvider æ¥å£

```typescript
interface AIVideoProvider {
  name: string;                 # Provider æ ‡è¯†
  supportImageToVideo: boolean; # æ˜¯å¦æ”¯æŒå›¾ç”Ÿè§†é¢‘

  createTask(
    params: VideoGenerationParams
  ): Promise<VideoTaskResponse>;

  getTaskStatus(
    taskId: string
  ): Promise<VideoTaskResponse>;

  parseCallback(
    payload: any
  ): VideoTaskResponse;
}
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [Evolink Provider](../ai/providers/evolink.ts) | Evolink å®ç°å‚è€ƒ |
| [KIE Provider](../ai/providers/kie.ts) | KIE å®ç°å‚è€ƒ |
| [æ¨¡å‹æ˜ å°„é…ç½®](../ai/model-mapping.ts) | å®Œæ•´æ˜ å°„é…ç½® |
| [ç±»å‹å®šä¹‰](../ai/types.ts) | æ‰€æœ‰æ¥å£å®šä¹‰ |
| [è®¡è´¹é…ç½®](../config/credits.ts) | ç§¯åˆ†è®¡ç®—è§„åˆ™ |
| [MODEL_MAPPING_COMPLETE](../docs/MODEL_MAPPING_COMPLETE.md) | è¯¦ç»†æ˜ å°„æ–‡æ¡£ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1
**æœ€åæ›´æ–°**: 2026-01-26
**ç»´æŠ¤è€…**: VideoFly Team
